<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù… Ø§Ù„ÙƒØ´ÙÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap"
        rel="stylesheet">
    <script type="importmap">
    {
      "imports": {
        "lucide": "https://esm.sh/lucide@0.344.0"
      }
    }
    </script>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-8px);
            }

            75% {
                transform: translateX(8px);
            }
        }

        .animate-fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .animate-shake {
            animation: shake 0.4s ease-in-out;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.15);
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-900">

    <!-- Full Screen Login -->
    <section class="min-h-screen relative flex items-center justify-center pt-20 pb-10 overflow-hidden bg-stone-900">
        <div class="absolute inset-0 z-0 opacity-20">
            <img src="/scout-website/camp_1.png" alt="Background" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-stone-900/90"></div>
        </div>

        <div class="relative z-10 w-full max-w-md px-4">
            <!-- Login Form -->
            <div id="login-card"
                class="glass-card rounded-[2rem] shadow-2xl p-10 border border-stone-100 relative overflow-hidden animate-fade-in">
                <div class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-bl-full -mr-10 -mt-10 z-0"></div>

                <div class="relative z-10 text-center mb-8">
                    <img src="/scout-website/logo.png" alt="Logo" class="w-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold text-stone-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                    <p class="text-stone-500 text-sm">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚Ø§Ø¯Ø©</p>
                </div>

                <!-- Error Banner -->
                <div id="login-error"
                    class="hidden mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm text-center font-bold">
                </div>

                <!-- Success Banner -->
                <div id="login-success"
                    class="hidden mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl text-sm text-center font-bold">
                </div>

                <form id="login-form" class="space-y-5 relative z-10">
                    <div class="space-y-2">
                        <label class="block text-sm font-bold text-stone-700">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <div class="relative">
                            <i data-lucide="mail" class="absolute right-4 top-3.5 text-stone-400 w-5 h-5"></i>
                            <input type="email" id="login-email" required
                                class="w-full bg-stone-50 border border-stone-200 rounded-xl py-3 pr-12 pl-4 focus:outline-none focus:border-green-500 transition"
                                placeholder="name@example.com">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-bold text-stone-700">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="relative">
                            <i data-lucide="lock" class="absolute right-4 top-3.5 text-stone-400 w-5 h-5"></i>
                            <input type="password" id="login-password" required
                                class="w-full bg-stone-50 border border-stone-200 rounded-xl py-3 pr-12 pl-4 focus:outline-none focus:border-green-500 transition"
                                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            <button type="button" id="toggle-password"
                                class="absolute left-4 top-3.5 text-stone-400 hover:text-stone-600 transition">
                                <i data-lucide="eye" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="remember-me" class="rounded text-green-600 focus:ring-green-500">
                            <span class="text-stone-600">ØªØ°ÙƒØ±Ù†ÙŠ</span>
                        </label>
                        <button type="button" id="show-reset" class="text-green-600 hover:text-green-700 font-bold">Ù†Ø³ÙŠØª
                            ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>
                    </div>

                    <button type="submit" id="login-btn"
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition transform active:scale-95 flex items-center justify-center gap-2">
                        <i data-lucide="log-in"></i> Ø¯Ø®ÙˆÙ„
                    </button>

                    <p class="text-center text-stone-500 text-sm mt-4">
                        Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="/scout-website/complaints.html"
                            class="text-green-600 font-bold hover:underline">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                    </p>
                </form>

                <!-- Password Reset Form (hidden) -->
                <form id="reset-form" class="space-y-5 relative z-10 hidden">
                    <div class="text-center mb-4">
                        <span class="text-4xl block mb-2">ğŸ”‘</span>
                        <h3 class="text-xl font-bold text-stone-800">Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                        <p class="text-stone-500 text-sm">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</p>
                    </div>

                    <div class="space-y-2">
                        <div class="relative">
                            <i data-lucide="mail" class="absolute right-4 top-3.5 text-stone-400 w-5 h-5"></i>
                            <input type="email" id="reset-email" required
                                class="w-full bg-stone-50 border border-stone-200 rounded-xl py-3 pr-12 pl-4 focus:outline-none focus:border-green-500 transition"
                                placeholder="name@example.com">
                        </div>
                    </div>

                    <button type="submit" id="reset-btn"
                        class="w-full bg-stone-900 hover:bg-stone-800 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                        Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                    </button>

                    <button type="button" id="back-to-login"
                        class="w-full text-stone-500 hover:text-stone-700 font-bold py-2 transition text-sm">
                        â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>

            <!-- Branding -->
            <p class="text-center text-stone-500 text-xs mt-6 opacity-60">Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù… Ø§Ù„ÙƒØ´ÙÙŠØ© Â© 2026</p>
        </div>
    </section>

    <script type="module">
        import { initStructure } from './js/structure_manager.js';
        import { supabase } from './js/supabase-config.js';

        document.addEventListener('DOMContentLoaded', async () => {
            initStructure();

            // Check if already logged in
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                window.location.href = '/scout-website/dashboard.html';
                return;
            }

            // === Login Form ===
            const loginForm = document.getElementById('login-form');
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = document.getElementById('login-btn');
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;

                hideMessages();
                btn.innerHTML = '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                btn.disabled = true;

                try {
                    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

                    if (error) {
                        showError(translateError(error.message));
                        document.getElementById('login-card').classList.add('animate-shake');
                        setTimeout(() => document.getElementById('login-card').classList.remove('animate-shake'), 500);
                    } else {
                        showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...');
                        setTimeout(() => {
                            window.location.href = '/scout-website/dashboard.html';
                        }, 1000);
                    }
                } catch (err) {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
                } finally {
                    btn.innerHTML = '<i data-lucide="log-in"></i> Ø¯Ø®ÙˆÙ„';
                    btn.disabled = false;
                }
            });

            // === Password Reset ===
            document.getElementById('show-reset').addEventListener('click', () => {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('reset-form').classList.remove('hidden');
                hideMessages();
            });

            document.getElementById('back-to-login').addEventListener('click', () => {
                document.getElementById('reset-form').classList.add('hidden');
                document.getElementById('login-form').classList.remove('hidden');
                hideMessages();
            });

            document.getElementById('reset-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('reset-email').value.trim();
                const btn = document.getElementById('reset-btn');

                btn.disabled = true;
                btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

                try {
                    const { error } = await supabase.auth.resetPasswordForEmail(email, {
                        redirectTo: window.location.origin + '/scout-website/login.html'
                    });

                    if (error) {
                        showError(translateError(error.message));
                    } else {
                        showSuccess('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                    }
                } catch (err) {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©';
                }
            });

            // === Toggle Password Visibility ===
            document.getElementById('toggle-password').addEventListener('click', () => {
                const pw = document.getElementById('login-password');
                pw.type = pw.type === 'password' ? 'text' : 'password';
            });
        });

        function showError(msg) {
            const el = document.getElementById('login-error');
            el.textContent = msg;
            el.classList.remove('hidden');
            document.getElementById('login-success').classList.add('hidden');
        }

        function showSuccess(msg) {
            const el = document.getElementById('login-success');
            el.textContent = msg;
            el.classList.remove('hidden');
            document.getElementById('login-error').classList.add('hidden');
        }

        function hideMessages() {
            document.getElementById('login-error').classList.add('hidden');
            document.getElementById('login-success').classList.add('hidden');
        }

        function translateError(msg) {
            const map = {
                'Invalid login credentials': 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'Email not confirmed': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø¤ÙƒØ¯',
                'For security purposes, you can only request this once every 60 seconds': 'Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©'
            };
            return map[msg] || msg;
        }
    </script>
</body>

</html>